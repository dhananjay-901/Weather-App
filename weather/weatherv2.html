<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interactive Weather Map</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: auto;
      background: #fff;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      text-align: center;
      padding: 30px;
    }
    #map { height: 450px; }
    .weather-info { padding: 30px; background: #f8f9fa; }
    .weather-card { display: none; background: #fff; padding: 20px; border-radius: 14px; box-shadow: 0 6px 20px rgba(0,0,0,0.1); }
    .weather-card.active { display: block; animation: fadeIn .5s ease; }
    @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

    .icons { font-size: 40px; }

    .toggle {
      margin-top: 10px;
      cursor: pointer;
      background: #667eea;
      padding: 6px 14px;
      display: inline-block;
      border-radius: 8px;
      color: #fff;
      font-size: 14px;
    }

    canvas { margin-top: 30px; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üå§Ô∏è Interactive Weather Map</h1>
      <p>Click anywhere on the map to get weather + 3‚Äëday forecast</p>
    </header>

    <div id="map"></div>

    <div class="weather-info">
      <div id="instruction" style="text-align:center; padding:40px; color:#555;">Click a location on the map to begin</div>

      <div class="weather-card" id="weatherCard">
        <h2 id="locationName"></h2>

        <div id="unitToggle" class="toggle">Switch to ¬∞F</div>

        <div id="currentWeather" style="display:flex; gap:20px; margin-top:20px; flex-wrap: wrap;"></div>

        <canvas id="forecastChart"></canvas>
      </div>
    </div>
  </div>

<script>
let marker;
let useFahrenheit = false;
let forecastChart;

const map = L.map('map').setView([20, 0], 2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

map.on('click', async (e) => {
  const lat = e.latlng.lat.toFixed(4);
  const lon = e.latlng.lng.toFixed(4);
  if (!marker) marker = L.marker(e.latlng).addTo(map);
  else marker.setLatLng(e.latlng);

  fetchWeather(lat, lon);
});

function iconForWeather(tempC, precip) {
  if (precip > 0) return 'üåßÔ∏è';
  if (tempC > 28) return '‚òÄÔ∏è';
  if (tempC > 15) return '‚õÖ';
  if (tempC > 5) return 'üå•Ô∏è';
  return '‚ùÑÔ∏è';
}

function CtoF(c) { return (c * 9/5 + 32).toFixed(1); }

async function fetchWeather(lat, lon) {
  document.getElementById('instruction').style.display = 'none';

  const weatherURL = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,precipitation,apparent_temperature,wind_speed_10m&daily=temperature_2m_max,temperature_2m_min,precipitation_sum&timezone=auto`;

  const geoURL = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=10`;

  const weatherData = await fetch(weatherURL).then(r=>r.json());
  const geoData = await fetch(geoURL, { headers:{'User-Agent':'WeatherApp'} }).then(r=>r.json());

  let name = geoData.address.city || geoData.address.town || geoData.address.village || geoData.address.state || `(${lat}, ${lon})`;
  if (geoData.address.country) name += ", " + geoData.address.country;

  displayWeather(weatherData, name);
}

function displayWeather(data, locationName) {
  const card = document.getElementById('weatherCard');
  const cw = document.getElementById('currentWeather');
  const loc = document.getElementById('locationName');
  loc.textContent = locationName;

  let temp = data.current.temperature_2m;
  let feels = data.current.apparent_temperature;
  let precip = data.current.precipitation;
  let wind = (data.current.wind_speed_10m * 3.6).toFixed(1);

  const icon = iconForWeather(temp, precip);

  const t = useFahrenheit ? CtoF(temp) : temp.toFixed(1);
  const f = useFahrenheit ? CtoF(feels) : feels.toFixed(1);
  const unit = useFahrenheit ? '¬∞F' : '¬∞C';

  cw.innerHTML = `
    <div class="icons">${icon}</div>
    <div><strong>Temperature:</strong> ${t}${unit}</div>
    <div><strong>Feels Like:</strong> ${f}${unit}</div>
    <div><strong>Wind:</strong> ${wind} km/h</div>
    <div><strong>Precipitation:</strong> ${precip} mm</div>
  `;

  renderForecastChart(data);

  card.classList.add('active');
}

function renderForecastChart(data) {
  const days = data.daily.time;
  let tmax = data.daily.temperature_2m_max;
  let tmin = data.daily.temperature_2m_min;

  if (useFahrenheit) {
    tmax = tmax.map(CtoF);
    tmin = tmin.map(CtoF);
  }

  if (forecastChart) forecastChart.destroy();

  const ctx = document.getElementById('forecastChart');

  forecastChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: days,
      datasets: [
        {
          label: 'Daily Max',
          data: tmax,
          borderWidth: 3
        },
        {
          label: 'Daily Min',
          data: tmin,
          borderWidth: 3
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: false }
      }
    }
  });
}

// Unit toggle

document.getElementById('unitToggle').onclick = () => {
  useFahrenheit = !useFahrenheit;
  document.getElementById('unitToggle').textContent = useFahrenheit ? 'Switch to ¬∞C' : 'Switch to ¬∞F';
};
</script>
</body>
</html>
